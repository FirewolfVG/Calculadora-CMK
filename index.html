<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora de Carreras de Caballos - CMK üá¶üá∑</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Chakra+Petch:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --gta-bg-dark: #1a1a1a;
      --gta-text-light: #f0f0f0;
      --gta-accent-orange: #f28a07;
      --gta-accent-red2: #c9938f;
      --gta-success-green: #28a745;
      --gta-danger-red: #dc3545;
      --gta-table-header: #333333;
      --gta-border-gray: #444444;
      --gta-input-bg: #2b2b2b;
      --gta-accent-blue: #007bff; /* Definido si no existe, o se adapta a un azul si ya existe */
      --gta-button-hover-blue: #0056b3; /* Para el hover del bot√≥n */
    }
    body {
      font-family: 'Chakra Petch', sans-serif;
      background-color: var(--gta-bg-dark);
      color: var(--gta-text-light);
      margin:0; padding:20px;
      display:flex; flex-direction:column;
      align-items:center; min-height:100vh;
      box-sizing:border-box;
    }
    .container {
      width:100%; max-width:850px;
      background:#222; padding:30px;
      border-radius:8px;
      box-shadow:0 0 20px rgba(0,0,0,0.5);
      border:1px solid var(--gta-border-gray);
      margin-bottom:20px;
    }
    h1,h2 {
      font-family:'Oswald', sans-serif;
      color:var(--gta-accent-orange);
      border-bottom:2px solid var(--gta-border-gray); /* Ajuste el color del borde para que sea m√°s consistente */
      padding-bottom:10px; margin-top:0;
      text-transform:uppercase; letter-spacing:1.5px;
    }
    h2{ margin-top:30px; }
    p{ line-height:1.6; font-size:0.95em; }
    table{ border-collapse:collapse; width:100%; margin-top:25px; border:1px solid var(--gta-border-gray); }
    th,td{ border:1px solid var(--gta-border-gray); padding:12px; text-align:center; vertical-align:middle; font-size:0.9em;}
    th{ background-color:var(--gta-table-header); color:var(--gta-accent-orange); font-weight:700; text-transform:uppercase;}
    tr:nth-child(even){ background-color:#2a2a2a; }
    .input-group{ display:flex; align-items:center; justify-content:center; }
    input[type="text"]{
      width:60%; padding:8px 10px;
      border:1px solid var(--gta-border-gray);
      border-radius:4px 0 0 4px;
      text-align:center; font-size:1em;
      background-color:var(--gta-input-bg);
      color:var(--gta-text-light);
    }
    .static-text{
      padding:8px 10px; background-color:var(--gta-input-bg);
      border:1px solid var(--gta-border-gray);
      border-left:none; border-radius:0 4px 4px 0;
      color:var(--gta-text-light); font-size:1em;
      pointer-events:none;
    }
    .button-group{ display:flex; gap:15px; margin-top:30px; flex-direction: column; align-items: center;}
    
    /* Estilo del bot√≥n "Calcular ganancia" */
    #calculateButton {
      width: 100%; /* El bot√≥n ocupa todo el ancho disponible */
      max-width: 400px; /* Ancho m√°ximo para el bot√≥n */
      padding:15px; font-size:1.1em;
      font-family:'Oswald', sans-serif; font-weight:bold;
      color:var(--gta-text-light);
      background: linear-gradient(145deg, #007bff, #0056b3); /* Degradado azul */
      border:none; border-radius:8px; cursor:pointer;
      box-shadow: 0 4px 10px rgba(0,123,255,0.4);
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    #calculateButton:hover{
      background: linear-gradient(145deg, #0056b3, #003a75); /* Degradado m√°s oscuro en hover */
      transform:translateY(-3px);
      box-shadow:0 6px 15px rgba(0,123,255,0.5);
    }

    .positivo{ color:var(--gta-success-green); font-weight:bold; }
    .negativo{ color:var(--gta-danger-red); font-weight:bold; }
    /* Resaltado extra */
    .highlight-total {
      font-size:1.3em;
      color:var(--gta-accent-orange);
      font-weight:bold;
    }
    .highlight-interpretacion {
      font-size:1.2em;
      color:var(--gta-accent-red2);
      font-weight:bold;
    }
    .footer{
      margin-top:26px;
      color:#777;
      font-size:1em; /* m√°s grande */
      text-align:center;
    }

    /* Estilos para el Switch */
    .switch-container {
      display: flex;
      align-items: center;
      justify-content: center; /* Centra el switch */
      gap: 10px;
      margin-bottom: 10px; /* Reducido para acercar la nota */
      font-size: 0.85em; /* Texto un poco m√°s peque√±o */
      color: #bbb;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 26px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: var(--gta-accent-orange);
    }
    input:focus + .slider {
      box-shadow: 0 0 1px var(--gta-accent-orange);
    }
    input:checked + .slider:before {
      transform: translateX(24px);
    }
    .switch-label {
      min-width: 80px; /* Asegura un ancho m√≠nimo para los labels */
      text-align: right;
    }
    .switch-label.active {
      color: var(--gta-text-light);
      font-weight: bold;
    }

    /* Estilo para la nota de Marbella */
    #marbella-note {
      font-size: 0.8em;
      color: var(--gta-accent-red2);
      text-align: center;
      margin-top: 5px; /* Espacio entre el switch y la nota */
      margin-bottom: 20px; /* Espacio entre la nota y el bot√≥n */
      max-width: 400px;
      display: none; /* Oculta por defecto */
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Calculadora de Carreras de Caballos - CMK</h1>

    <table id="tabla-inputs">
      <thead><tr><th>Caballo</th><th>Cuota</th></tr></thead>
      <tbody>
        <tr><td>Caballo 1</td><td><div class="input-group"><input id="c1" type="text"><span class="static-text">/1</span></div></td></tr>
        <tr><td>Caballo 2</td><td><div class="input-group"><input id="c2" type="text"><span class="static-text">/1</span></div></td></tr>
        <tr><td>Caballo 3</td><td><div class="input-group"><input id="c3" type="text"><span class="static-text">/1</span></div></td></tr>
        <tr><td>Caballo 4</td><td><div class="input-group"><input id="c4" type="text"><span class="static-text">/1</span></div></td></tr>
        <tr><td>Caballo 5</td><td><div class="input-group"><input id="c5" type="text"><span class="static-text">/1</span></div></td></tr>
        <tr><td>Caballo 6</td><td><div class="input-group"><input id="c6" type="text"><span class="static-text">/1</span></div></td></tr>
      </tbody>
    </table>

    <div class="button-group">
      <div class="switch-container">
        <span id="labelOptima" class="switch-label">Apuesta √ìptima</span>
        <label class="switch">
          <input type="checkbox" id="marbellaSwitch" checked onchange="updateSwitchLabels(); calcularGananciaVariable();">
          <span class="slider round"></span>
        </label>
        <span id="labelMarbella" class="switch-label active">Apuesta Marbella</span>
      </div>
      <!-- Nota de advertencia para el modo Marbella -->
      <div id="marbella-note">
        Con el modo "Apuesta Marbella", las apuestas se redondean, lo que reduce significativamente las probabilidades de ganancia.
      </div>
      <button id="calculateButton" onclick="calcularGananciaVariable()">Calcular Ganancia</button>
    </div>

    <div id="resultados"></div>
  </div>

  <footer class="footer">Desarrollado por GreppiVg para la Khantown</footer>

<script>
const marbellaBets = [100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000];

function parseCuota(txt) {
  if(typeof txt !== 'string' || !txt.trim()) return NaN;
  const val1 = parseFloat(txt);
  if (isNaN(val1) || val1 <= 0) return NaN;
  return val1;
}

function getCuotasAndProbabilidades() {
  let cuotasData = [];
  for (let i = 1; i <= 6; i++) {
    const cuotaNum = parseCuota(document.getElementById("c" + i).value);
    if (isNaN(cuotaNum) || cuotaNum <= 0) {
        alert(`La cuota para el Caballo ${i} es inv√°lida. Por favor, ingrese un valor num√©rico positivo.`);
        return null;
    }
    const probabilidad = 1 / (cuotaNum + 1);
    cuotasData.push({ caballo: i, cuota: cuotaNum, probabilidad: probabilidad });
  }
  return cuotasData;
}

function interpretarProbabilidad(pct) {
  if (pct === 100) return 'üéØ √âXITO TOTAL: Las probabilidades est√°n completamente a tu favor. Tremeeendo!.';
  if (pct > 90)  return 'üî• Muy alta: Excelente oportunidad, el riesgo es m√≠nimo, como con Mila al volante.';
  if (pct > 70)  return '‚úÖ Alta: Buenas probabilidades, un momento favorable. Si no lo haces vuelve Phil Stones a la CMK.';
  if (pct > 50)  return '‚öñÔ∏è Media: Equilibrado. Podr√≠a valer la pena apostar. Ollie mi barquito';
  if (pct > 30)  return '‚ö†Ô∏è Baja: Riesgo significativo, mas si hay un colorado en la sala.';
  return 'üö® Muy baja: Las chances de ganar son m√≠nimas. no seas vecino de Curry.';
}

function roundToMarbellaBet(betAmount) {
  let closest = marbellaBets[0];
  let minDiff = Math.abs(betAmount - closest);

  for (let i = 1; i < marbellaBets.length; i++) {
    const currentDiff = Math.abs(betAmount - marbellaBets[i]);
    if (currentDiff < minDiff) {
      minDiff = currentDiff;
      closest = marbellaBets[i];
    } else if (currentDiff === minDiff && marbellaBets[i] < betAmount) {
      // Si hay dos valores equidistantes, elige el menor para no exceder tanto
      closest = marbellaBets[i];
    }
  }
  return closest;
}

function calcularGananciaVariable() {
  const maxApuestaIndividual = 10000;
  const apuestaFavoritoFija = 10000;
  const isMarbellaMode = document.getElementById("marbellaSwitch").checked;

  let cuotas = getCuotasAndProbabilidades();
  if (!cuotas) return;

  cuotas.sort((a,b)=> b.probabilidad - a.probabilidad);
  const caballoFavorito = cuotas[0];

  let apuestasFinales = [];
  let apuestaFav = apuestaFavoritoFija;
  if (isMarbellaMode) {
      apuestaFav = roundToMarbellaBet(apuestaFavoritoFija);
  }
  apuestasFinales.push({ ...caballoFavorito, apuesta: apuestaFav });

  // Este es el cobro total si el favorito gana, incluyendo la apuesta inicial.
  const cobroTotalFavoritoSiGana = apuestaFav * (caballoFavorito.cuota + 1);
  let apuestasNoFavCalculadas = [];
  const baseIncrementoGananciaPorCuota = cobroTotalFavoritoSiGana * 0.05;

  for (let i = 1; i < cuotas.length; i++) {
    const c = cuotas[i];
    let diferenciaCuotaRelativa = Math.log(c.cuota / caballoFavorito.cuota);
    if (diferenciaCuotaRelativa < 0) diferenciaCuotaRelativa = 0;
    let gananciaAdicional_i = baseIncrementoGananciaPorCuota * diferenciaCuotaRelativa;
    let apuesta_i = (cobroTotalFavoritoSiGana + gananciaAdicional_i) / (c.cuota + 1);

    if (isMarbellaMode) {
        apuesta_i = roundToMarbellaBet(apuesta_i);
    }
    if (apuesta_i > maxApuestaIndividual) apuesta_i = maxApuestaIndividual;
    
    apuestasNoFavCalculadas.push({ ...c, apuesta: apuesta_i });
  }

  let totalInversion = apuestasFinales[0].apuesta + apuestasNoFavCalculadas.reduce((s,x)=> s + x.apuesta, 0);

  let adjustedApuestasNoFav = [];
  apuestasNoFavCalculadas.forEach(c => {
    let apuestaAjustada = c.apuesta;
    // Si la ganancia potencial (apuesta + ganancia) es menor que la inversi√≥n total, ajustamos la apuesta para cubrir al menos la inversi√≥n
    if ((apuestaAjustada * (c.cuota + 1)) < totalInversion) {
        apuestaAjustada = totalInversion / (c.cuota + 1);
        if (isMarbellaMode) {
            apuestaAjustada = roundToMarbellaBet(apuestaAjustada);
        }
        if (apuestaAjustada > maxApuestaIndividual) apuestaAjustada = maxApuestaIndividual;
    }
    adjustedApuestasNoFav.push({ ...c, apuesta: apuestaAjustada });
  });

  apuestasFinales = [apuestasFinales[0], ...adjustedApuestasNoFav];
  totalInversion = apuestasFinales.reduce((sum, current) => sum + current.apuesta, 0);

  let html = `<h2>üìà Resultados de la Apuesta con Ganancia Variable</h2>`;
  html += `<p class="highlight-total">Monto total a invertir: $${totalInversion.toFixed(2)}</p>`;
  html += `<table>
      <thead>
      <tr>
          <th>Caballo</th>
          <th>Apuesta</th>
          <th>Ganancia Neta si gana</th>
          <th>Profit</th>
      </tr>
      </thead>
      <tbody>`;

  let probProfitRaw = 0;
  let sumImplied = 0;

  apuestasFinales.forEach(r => {
      // Revertido a la l√≥gica original: Ganancia Neta es solo el monto ganado, sin incluir la apuesta inicial
      const gananciaNetaSiGana = r.apuesta * r.cuota; 
      const profit = gananciaNetaSiGana - totalInversion; // El profit se calcula sobre la ganancia neta
      const claseGanancia = gananciaNetaSiGana > totalInversion ? 'positivo' : 'negativo';
      const claseProfit = profit >= 0 ? 'positivo' : 'negativo';

      if (profit >= 0) probProfitRaw += r.probabilidad;
      sumImplied += r.probabilidad;

      html += `<tr>
          <td>Caballo ${r.caballo} (${r.cuota.toFixed(2)}/1)</td>
          <td>$${r.apuesta.toFixed(2)}</td>
          <td class="${claseGanancia}">$${gananciaNetaSiGana.toFixed(2)}</td>
          <td class="${claseProfit}">$${profit.toFixed(2)}</td>
      </tr>`;
  });

  html += `</tbody></table>`;

  let probProfitNormalized = 0;
  if (sumImplied > 0) {
    probProfitNormalized = probProfitRaw / sumImplied;
  }

  const normPct = (probProfitNormalized * 100);
  html += `<p><b>Probabilidad normalizada de ganar:</b> <span class="${normPct >= 50 ? 'positivo' : 'negativo'}">${normPct.toFixed(2)}%</span></p>`;

  const interpretacion = interpretarProbabilidad(normPct);
  html += `<p class="highlight-interpretacion">Interpretaci√≥n: ${interpretacion}</p>`;

  document.getElementById("resultados").innerHTML = html;
}

// Funci√≥n para actualizar los estilos de los labels del switch y la visibilidad de la nota
function updateSwitchLabels() {
    const isMarbellaMode = document.getElementById("marbellaSwitch").checked;
    const labelOptima = document.getElementById("labelOptima");
    const labelMarbella = document.getElementById("labelMarbella");
    const marbellaNote = document.getElementById("marbella-note");

    if (isMarbellaMode) {
        labelOptima.classList.remove("active");
        labelMarbella.classList.add("active");
        marbellaNote.style.display = "block"; // Muestra la nota
    } else {
        labelOptima.classList.add("active");
        labelMarbella.classList.remove("active");
        marbellaNote.style.display = "none"; // Oculta la nota
    }
}

// Inicializar los labels y calcular al cargar la p√°gina
document.addEventListener("DOMContentLoaded", () => {
    updateSwitchLabels();
    // No llamamos a calcularGananciaVariable() aqu√≠ si no queremos que se calcule autom√°ticamente al cargar
    // Si queremos que se calcule autom√°ticamente al cargar, descomentar la siguiente l√≠nea:
    // calcularGananciaVariable();
});
</script>
</body>
</html>